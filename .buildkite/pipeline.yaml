steps:
  - label: ':lipstick:'
    command: .buildkite/prettier-check.sh
  - label: ':lipstick:'
    command: .buildkite/shfmt.sh

  - wait

<<<<<<< HEAD
  - label: ':rocket: :k8s:'
    branches: 'release'
=======
  - label: ":pulumi: :k8s:"
    concurrency: 3
    concurrency_group: deploy-sourcegraph/integration
    command: .buildkite/integration-test.sh
    env:
      VERBOSE: "true"
      # Can be set to true to help debug test results, but ensure that created resources
      # are removed manually
      NOCLEANUP: "false"

  - label: ":k8s:"
    concurrency: 3
    concurrency_group: deploy-sourcegraph/integration-restricted
    command: .buildkite/integration-restricted-test.sh
    env:
      # Can be set to true to help debug test results, but ensure that created resources
      # are removed manually
      NOCLEANUP: "false"

  - wait: ~
    continue_on_failure: true
  
  - label: ":gcompute: :floppy_disk: ðŸ§¹"
>>>>>>> dd4f963852123d0b580d022b904e59fbcece0984
    concurrency: 1
    concurrency_group: dogfood/deploy
    commands:
      - gcloud container clusters get-credentials dogfood --zone us-central1-f --project sourcegraph-dogfood
      # Set up the namespace
      - kubectl config set-context --current --namespace=dogfood-k8s
      # Deploy relevant Kubernetes bits
      - ./kubectl-apply-all.sh --context="gke_sourcegraph-dogfood_us-central1-f_dogfood"
