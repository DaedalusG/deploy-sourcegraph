steps:
  - label: ":k8s:"
    command: .buildkite/verify-yaml.sh
  - label: ":k8s:"
    command: .buildkite/verify-label.sh
  - label: ":k8s:"
    command: .buildkite/verify-rbac-labels.sh
  - label: ':lipstick:'
    command: .buildkite/prettier-check.sh
  - label: ':lipstick:'
    command: .buildkite/shfmt.sh

  - wait

  - label: ':rocket: :k8s:'
    branches: 'release'
    concurrency: 1
    concurrency_group: dogfood/deploy
    commands:
      - gcloud container clusters get-credentials dogfood --zone us-central1-f --project sourcegraph-dogfood
      - ./kubectl-apply-all.sh --dry-run=client --context="gke_sourcegraph-dogfood_us-central1-f_dogfood"
